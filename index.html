<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¥¥åˆ©ç»™ï¼</title>
  <meta name="theme-color" content="#4f46e5" />
  <link rel="manifest" href="manifest.json" />
  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: { extend: {
        fontFamily: { sans: ['Inter','ui-sans-serif','system-ui'] },
        colors: { primary:'#4f46e5' }
      } }
    };
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <!-- React + ReactDOM (UMD) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone@7/babel.min.js"></script>
  <!-- Fuse.js -->
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
  <!-- Firebase (compat UMD) - Auth only -->
  <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>

  <style>
    :root { color-scheme: dark; }
    body{ font-family: Inter, ui-sans-serif, system-ui, -apple-system; }
    /* èƒŒæ™¯åŠ¨æ•ˆ */
    @keyframes blobFloat{0%{transform:translate3d(0,0,0) scale(1)}100%{transform:translate3d(3vw,-2vh,0) scale(1.06)}}
  </style>
</head>
<body class="min-h-screen text-white bg-gradient-to-b from-[#0b1220] via-[#0e1530] to-[#0b1220]">
  <!-- èƒŒæ™¯å±‚ -->
  <div class="pointer-events-none fixed inset-0 -z-10">
    <div class="absolute inset-0" style="background:
      radial-gradient(1200px 800px at 10% 5%, rgba(31,41,55,1) 0%, rgba(31,41,55,0) 35%),
      radial-gradient(900px 700px at 85% 15%, rgba(55,48,163,0.35) 0%, rgba(55,48,163,0) 45%),
      radial-gradient(900px 700px at 20% 85%, rgba(16,185,129,0.25) 0%, rgba(16,185,129,0) 40%),
      linear-gradient(180deg,#0b1220 0%, #0f172a 45%, #111827 100%)
    "></div>
    <div class="absolute inset-0 opacity-20" style="background-image:
      linear-gradient(to right, rgba(255,255,255,.05) 1px, transparent 1px),
      linear-gradient(to bottom, rgba(255,255,255,.05) 1px, transparent 1px);
      background-size:28px 28px;"></div>
    <div class="absolute w-[38vw] h-[38vw] max-w-[680px] max-h-[680px] rounded-full blur-[40px] opacity-70 mix-blend-multiply bg-gradient-to-br from-indigo-400 to-blue-400 animate-[blobFloat_16s_ease-in-out_infinite_alternate] -top-[10vh] -left-[10vw]"></div>
    <div class="absolute w-[38vw] h-[38vw] max-w-[680px] max-h-[680px] rounded-full blur-[40px] opacity-70 mix-blend-multiply bg-gradient-to-br from-amber-400 to-rose-500 animate-[blobFloat_16s_ease-in-out_infinite_alternate] top-[20vh] -right-[12vw]" style="animation-delay:.6s"></div>
    <div class="absolute w-[38vw] h-[38vw] max-w-[680px] max-h-[680px] rounded-full blur-[40px] opacity-70 mix-blend-multiply bg-gradient-to-br from-emerald-400 to-cyan-400 animate-[blobFloat_16s_ease-in-out_infinite_alternate] -bottom-[12vh] left-[20vw]" style="animation-delay:1.2s"></div>
  </div>

  <div id="root"></div>

  <script type="text/babel">
    const { useEffect, useMemo, useState } = React;

    // ---------------- å·¥å…· ----------------
    const uid = () => Math.random().toString(36).slice(2) + Date.now().toString(36);

    function autoSummarize(text){
      if(!text) return '';
      const clean = text.replace(/\\s+/g,' ').trim();
      const first = clean.split(/[ã€‚.!?ï¼›;]\\s*/)[0] || clean.slice(0,80);
      const words = clean.toLowerCase().match(/[\\p{L}\\p{N}_\\-]{2,}/gu) || [];
      const stop = new Set(['the','and','for','with','that','this','you','your','æˆ‘ä»¬','ä»¥åŠ','çš„æ˜¯','å¯ä»¥','å¦‚ä½•','ä¸€ä¸ª','æç¤º','prompt','å†…å®¹']);
      const freq = {};
      words.forEach(w=>{ if(!stop.has(w)) freq[w]=(freq[w]||0)+1; });
      const top = Object.entries(freq).sort((a,b)=>b[1]-a[1]).slice(0,4).map(x=>x[0]);
      let res = first;
      if(top.length) res += ' ï½œ å…³é”®è¯ï¼š' + top.join('ã€');
      return res.slice(0,84);
    }

    const SYNONYMS = {
      "å¤–è´¸": ["å›½é™…è´¸æ˜“","B2B","å‡ºå£","æµ·å…³","è´¸æ˜“"],
      "å®¢æˆ·å¼€å‘": ["è·å®¢","çº¿ç´¢","sales prospecting","å¼€å‘ä¿¡","è·Ÿè¿›"],
      "é‚®ä»¶": ["email","ç”µé‚®","é‚®ä»¶æ¨¡æ¿","é‚®ä»¶ä¸»é¢˜"],
      "å¤©çº¿": ["antenna","GPS","GNSS","4G","5G","LoRa","WiFi","å«æ˜Ÿ"],
      "è§†é¢‘": ["çŸ­è§†é¢‘","æŠ–éŸ³","å‰ªè¾‘","è„šæœ¬","åˆ†é•œ","TikTok"],
      "è‹±æ–‡": ["è‹±è¯­","English","å£è¯­","ç¿»è¯‘"],
      "æœç´¢": ["æŸ¥æ‰¾","æ£€ç´¢","è¯­ä¹‰","æ¨¡ç³ŠåŒ¹é…","ç›¸å…³æ€§"],
      "æ ‡ç­¾": ["tag","åˆ†ç±»","å½’æ¡£"]
    };
    function expandQuery(q){
      const bag = new Set([q]);
      Object.entries(SYNONYMS).forEach(([k,arr])=>{
        if(q.includes(k)) arr.forEach(s=>bag.add(s));
        if(arr.some(v=>q.includes(v))) bag.add(k);
      });
      return Array.from(bag);
    }

    // -------------- æœ¬åœ°å­˜å‚¨ Hook --------------
    function useLocalState(key, initial){
      const [state, setState] = useState(()=>{
        try{ const raw = localStorage.getItem(key); return raw? JSON.parse(raw): initial; } catch { return initial; }
      });
      useEffect(()=>{ try{ localStorage.setItem(key, JSON.stringify(state)); }catch{} }, [key, state]);
      return [state, setState];
    }

    // -------------- Firebase Auth --------------
    // TODO: å°†ä¸‹é¢çš„ firebaseConfig æ›¿æ¢ä¸ºä½ çš„ Firebase é¡¹ç›®é…ç½®
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBePfEThajXkfixYc-oUl9m8htKcXRuuI8",
  authDomain: "prompt-29d34.firebaseapp.com",
  projectId: "prompt-29d34",
  storageBucket: "prompt-29d34.firebasestorage.app",
  messagingSenderId: "2282413195",
  appId: "1:2282413195:web:1ecae5e1a116be239b488e",
  measurementId: "G-R7TW7M0L5M"
};
    let app, auth;
    try {
      app = firebase.initializeApp(firebaseConfig);
      auth = firebase.auth();
    } catch (e) {
      console.warn("Firebase åˆå§‹åŒ–å¤±è´¥ï¼šè¯·å¡«å†™æ­£ç¡®çš„ firebaseConfigã€‚", e);
    }

    // -------------- ç»ç’ƒå¡ç‰‡ --------------
    const GlassCard = ({ children, className='' }) => (
      <div className={'rounded-2xl border border-white/20 bg-white/10 backdrop-blur-xl shadow-xl ' + className}>{children}</div>
    );

    const Badge = ({ children }) => (
      <span className="px-2 py-0.5 rounded-full text-xs bgç™½/20 textç™½/90 border borderç™½/30">{children}</span>
    );

    const IconButton = ({ title, onClick, children }) => (
      <button title={title} onClick={onClick}
        className="inline-flex items-center justify-center rounded-lg border border-white/10 bg-white/20 hover:bg-white/30 text-white/90 px-2.5 py-2 shadow-sm transition-transform active:scale-95">
        {children}
      </button>
    );

    const PrimaryButton = ({ children, onClick }) => (
      <button onClick={onClick} className="px-4 py-2 rounded-xl bg-indigo-500/90 hover:bg-indigo-500 text-white font-semibold shadow-lg shadow-indigo-500/20">
        {children}
      </button>
    );

    // -------------- ä¸»åº”ç”¨ --------------
    function App(){
      // Auth çŠ¶æ€
      const [user, setUser] = useState(null);
      const [authReady, setAuthReady] = useState(false);
      const [showAuth, setShowAuth] = useState(false);
      const [authMode, setAuthMode] = useState('login'); // login | register

      useEffect(()=>{
        if(!auth) { setAuthReady(true); return; }
        const unsub = auth.onAuthStateChanged(u=>{ setUser(u); setAuthReady(true); });
        return ()=>unsub && unsub();
      }, []);

      // æ•°æ®
      const [projects, setProjects] = useLocalState('rx_projects', [{ id:'default', name:'é»˜è®¤é¡¹ç›®' }]);
      const [prompts, setPrompts] = useLocalState('rx_prompts', []);

      // UI çŠ¶æ€
      const [selectedProjectId, setSelectedProjectId] = useState('all');
      const [search, setSearch] = useState('');
      const [sort, setSort] = useState('newest');
      const [showCreate, setShowCreate] = useState(false);
      const [editing, setEditing] = useState(null);
      const [detail, setDetail] = useState(null);
      const [suggestions, setSuggestions] = useState([]);

      // Fuse ç´¢å¼•
      const fuse = React.useMemo(()=>{
        return new Fuse(prompts, {
          includeScore:true, shouldSort:true, threshold:0.32,
          keys:[
            { name:'title', weight:0.5 },
            { name:'content', weight:0.45 },
            { name:'summary', weight:0.25 },
            { name:'projectName', getFn:(p)=> projects.find(x=>x.id===p.projectId)?.name || '', weight:0.1 }
          ]
        });
      }, [prompts, projects]);

      // è”æƒ³è¯
      useEffect(()=>{
        const q = search.trim(); if(!q) return setSuggestions([]);
        setSuggestions(expandQuery(q).slice(1,7));
      }, [search]);

      // è¿‡æ»¤æ’åº
      const filtered = useMemo(()=>{
        let data = prompts.slice();
        if(selectedProjectId==='favorites') data = data.filter(p=>p.favorite);
        else if(selectedProjectId==='unassigned') data = data.filter(p=>!p.projectId);
        else if(selectedProjectId!=='all') data = data.filter(p=>p.projectId===selectedProjectId);

        const term = search.trim().toLowerCase();
        if(term){
          const expanded = expandQuery(term).join(' ');
          const ids = new Set(fuse.search(expanded).map(r=>r.item.id));
          data = data.filter(p=>ids.has(p.id));
        }

        switch (sort) {
          case 'newest': data.sort((a,b)=>(b.createdAt||0)-(a.createdAt||0)); break;
          case 'oldest': data.sort((a,b)=>(a.createdAt||0)-(b.createdAt||0)); break;
          case 'title-az': data.sort((a,b)=>(a.title||'').localeCompare(b.title||'')); break;
          case 'title-za': data.sort((a,b)=>(b.title||'').localeCompare(a.title||'')); break;
        }
        return data;
      }, [prompts, selectedProjectId, search, sort, fuse]);

      // ç»Ÿè®¡
      const countAll = prompts.length;
      const countFav = prompts.filter(p=>p.favorite).length;
      const countUnassigned = prompts.filter(p=>!p.projectId).length;

      // CRUD
      function createProject(name){
        if(!name?.trim()) return;
        setProjects(arr=>[...arr, { id:uid(), name:name.trim() }]);
      }
      function createPrompt({title, content, projectId}){
        const now = Date.now();
        const p = { id:uid(), title, content, projectId:projectId||null, favorite:false, createdAt:now, summary:autoSummarize(content) };
        setPrompts(arr=>[p, ...arr]);
      }
      function updatePrompt(id, patch){
        setPrompts(arr=>arr.map(p=> p.id===id ? {...p, ...patch, summary: (patch.content? autoSummarize(patch.content): (patch.summary ?? p.summary))} : p));
      }
      function deletePrompt(id){ setPrompts(arr=>arr.filter(p=>p.id!==id)); }

      // åˆæ¬¡ç¤ºä¾‹
      useEffect(()=>{
        if(prompts.length===0){
          setPrompts([
            { id:uid(), title:'å¤–è´¸å¼€å‘ä¿¡ï¼ˆç®€æ´å‹ï¼‰', content:'Write a concise cold email to a buyer in antenna industry. Include 2 SKUs and 1 sentence social proof.', projectId:'default', favorite:true, createdAt:Date.now()-3600e3, summary:'å¤–è´¸å¼€å‘ä¿¡æ¨¡æ¿ï¼ŒåŒ…å«2ä¸ªSKUä¸ç¤¾è¯æ˜å¥ã€‚' },
            { id:uid(), title:'è‹±æ–‡å£è¯­è§†é¢‘è„šæœ¬ï¼ˆ60ç§’ï¼‰', content:'Create a 60s script for English speaking practice. Mid-speed, native expressions, call to action at end.', projectId:null, favorite:false, createdAt:Date.now()-30e3, summary:'60ç§’å£è¯­è®­ç»ƒè„šæœ¬ï¼Œåä¸­é€Ÿã€åœ°é“è¡¨è¾¾ï¼Œæ”¶å°¾æœ‰CTAã€‚' }
          ]);
        }
      }, []);

      // PWA æ³¨å†Œ
      useEffect(()=>{
        if('serviceWorker' in navigator){
          window.addEventListener('load', ()=>{
            navigator.serviceWorker.register('sw.js').catch(()=>{});
          });
        }
      }, []);

      return (
        <div className="relative">
          {/* é¡¶æ  */}
          <header className="sticky top-0 z-30 backdrop-blur-xl bgç™½/5 border-b borderç™½/10">
            <div className="max-w-7xl mx-auto px-4 py-3 flex items-center gap-4">
              <div className="flex items-center gap-3">
                <div className="w-8 h-8 rounded-xl bg-gradient-to-br from-indigo-400 to-fuchsia-500 shadow-lg" />
                <div className="font-semibold tracking-wide">å¥¥åˆ©ç»™ï¼</div>
                <div className="hidden sm:flex items-center gap-2 text-white/70">
                  <Badge>React</Badge>
                  <Badge>è¯­ä¹‰æœç´¢</Badge>
                  <Badge>è‡ªåŠ¨æ‘˜è¦</Badge>
                </div>
              </div>
              <div className="ml-auto flex items-center gap-2">
                {authReady && auth
                  ? user
                    ? <>
                        <span className="text-xs text-white/70 hidden sm:inline">å·²ç™»å½•ï¼š{user.email}</span>
                        <button onClick={()=>auth.signOut()} className="px-3 py-1.5 rounded-lg bgç™½/10 border borderç™½/20">é€€å‡º</button>
                      </>
                    : <button onClick={()=>setShowAuth(true)} className="px-3 py-1.5 rounded-lg bg-indigo-500/90 hover:bg-indigo-500">ç™»å½• / æ³¨å†Œ</button>
                  : <span className="text-xs text-white/60">ï¼ˆæœªå¯ç”¨ Firebaseï¼‰</span>
                }
                <PrimaryButton onClick={()=>setShowCreate(true)}>æ–°å»º Prompt</PrimaryButton>
              </div>
            </div>
          </header>

          {/* ä¸»ä½“ */}
          <div className="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-[270px,1fr] gap-4 px-4 py-6">
            {/* ä¾§è¾¹æ  */}
            <GlassCard className="p-4 lg:h-[calc(100vh-120px)] lg:sticky lg:top-[84px]">
              <h2 className="text-lg font-semibold mb-3">é¡¹ç›® / è§†å›¾</h2>
              <nav className="space-y-2">
                <SidebarItem active={selectedProjectId==='all'} label="å…¨éƒ¨" count={countAll} onClick={()=>setSelectedProjectId('all')} />
                <SidebarItem active={selectedProjectId==='favorites'} label="â¤ï¸ æˆ‘çš„æ”¶è—" count={countFav} onClick={()=>setSelectedProjectId('favorites')} />
                <SidebarItem active={selectedProjectId==='unassigned'} label="æœªå½’æ¡£" count={countUnassigned} onClick={()=>setSelectedProjectId('unassigned')} />
                <div className="h-px bgç™½/10 my-2" />
                <div className="flex items-center justify-between mb-1 text-sm text-white/70">
                  <span>é¡¹ç›®</span>
                  <button onClick={()=>{ const n=prompt('æ–°é¡¹ç›®åç§°'); if(n) createProject(n); }} className="text-indigo-300 hover:text-indigo-200">+ æ–°å»º</button>
                </div>
                <div className="space-y-1">
                  {projects.map(p=> (
                    <SidebarItem key={p.id} active={selectedProjectId===p.id} label={p.name||'æœªå‘½åé¡¹ç›®'} count={prompts.filter(x=>x.projectId===p.id).length} onClick={()=>setSelectedProjectId(p.id)} />
                  ))}
                </div>
              </nav>
            </GlassCard>

            {/* å†…å®¹åŒº */}
            <div className="space-y-4">
              <GlassCard className="p-4">
                <div className="flex flex-col md:flex-row gap-3 md:items-center">
                  <div className="flex-1">
                    <input value={search} onChange={e=>setSearch(e.target.value)} placeholder="è¾“å…¥å…³é”®è¯æˆ–è‡ªç„¶è¯­è¨€ï¼ˆæ”¯æŒæ¨¡ç³Š/è¯­ä¹‰è”æƒ³ï¼‰..." className="w-full rounded-xl bgç™½/10 border borderç™½/20 px-4 py-2.5 placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-indigo-400/50" />
                    {suggestions.length>0 && (
                      <div className="mt-2 flex flex-wrap gap-2">
                        {suggestions.map(s=> (
                          <button key={s} onClick={()=>setSearch(v=>(v+' '+s).trim())} className="text-xs px-2 py-1 rounded-full bg-indigo-400/15 text-indigo-200 border border-indigo-300/20 hover:bg-indigo-400/25">{s}</button>
                        ))}
                      </div>
                    )}
                  </div>
                  <select value={sort} onChange={e=>setSort(e.target.value)} className="md:w-52 rounded-xl bgç™½/10 border borderç™½/20 px-3 py-2 focus:outline-none">
                    <option value="newest">æŒ‰æœ€æ–°åˆ›å»º</option>
                    <option value="oldest">æŒ‰æœ€æ—§åˆ›å»º</option>
                    <option value="title-az">æŒ‰æ ‡é¢˜ (A-Z)</option>
                    <option value="title-za">æŒ‰æ ‡é¢˜ (Z-A)</option>
                  </select>
                </div>
              </GlassCard>

              {filtered.length===0
                ? <EmptyState onCreate={()=>setShowCreate(true)} />
                : <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                    {filtered.map(p=> (
                      <PromptCard
                        key={p.id}
                        prompt={p}
                        projectName={projects.find(x=>x.id===p.projectId)?.name}
                        onOpen={()=>setDetail(p)}
                        onToggleFav={()=>updatePrompt(p.id, { favorite: !p.favorite })}
                        onCopy={()=>navigator.clipboard.writeText(p.content||'')}
                      />
                    ))}
                  </div>
              }
            </div>
          </div>

          {/* ç™»å½•å¼¹çª— */}
          {showAuth && (
            <Modal title={authMode==='login' ? 'ç”¨æˆ·ç™»å½•' : 'ç”¨æˆ·æ³¨å†Œ'} onClose={()=>setShowAuth(false)}>
              <AuthForm mode={authMode} onToggle={()=>setAuthMode(m=> m==='login' ? 'register' : 'login')} />
            </Modal>
          )}

          {/* åˆ›å»º/è¯¦æƒ…/ç¼–è¾‘å¼¹çª— */}
          {showCreate && (
            <Modal title="æ–°å»º Prompt" onClose={()=>setShowCreate(false)}>
              <PromptEditor projects={projects} onSubmit={(data)=>{ if(data){ createPrompt(data); } setShowCreate(false); }} />
            </Modal>
          )}
          {detail && (
            <Modal title={detail.title||'(æœªå‘½å)'} onClose={()=>setDetail(null)}>
              <div className="space-y-3">
                {detail.summary && <div className="text-sm text-white/80 bgç™½/5 border borderç™½/10 rounded-lg p-3">ã€æ‘˜è¦ã€‘{detail.summary}</div>}
                <pre className="whitespace-pre-wrap text-sm leading-relaxed text-white/90 bgç™½/5 border borderç™½/10 rounded-lg p-3">{detail.content}</pre>
                <div className="flex items-center justify-between text-xs textç™½/60">
                  <span>{detail.createdAt? new Date(detail.createdAt).toLocaleString(): ''}</span>
                  <div className="flex gap-2">
                    <IconButton title="å¤åˆ¶" onClick={()=>navigator.clipboard.writeText(detail.content||'')}>ğŸ“‹</IconButton>
                    <IconButton title="æ”¶è—" onClick={()=>{ updatePrompt(detail.id, { favorite: !detail.favorite }); setDetail({...detail, favorite:!detail.favorite}); }}>â­</IconButton>
                    <IconButton title="ç¼–è¾‘" onClick={()=>{ setEditing(detail); setDetail(null); }}>âœï¸</IconButton>
                    <IconButton title="åˆ é™¤" onClick={()=>{ if(confirm('ç¡®å®šåˆ é™¤ï¼Ÿ')){ deletePrompt(detail.id); setDetail(null); } }}>ğŸ—‘ï¸</IconButton>
                  </div>
                </div>
              </div>
            </Modal>
          )}
          {editing && (
            <Modal title="ç¼–è¾‘ Prompt" onClose={()=>setEditing(null)}>
              <PromptEditor
                projects={projects}
                initial={{ title: editing.title, content: editing.content, projectId: editing.projectId || '' }}
                onSubmit={(data)=>{ if(data){ updatePrompt(editing.id, data); } setEditing(null); }}
              />
            </Modal>
          )}
        </div>
      );
    }

    const SidebarItem = ({ active, onClick, label, count }) => (
      <button onClick={onClick}
        className={'w-full flex items-center justify-between px-3 py-2 rounded-xl transition border ' + (active ? 'bg-indigo-400/20 border-indigo-300/30 text-white' : 'bgç™½/5 borderç™½/10 text-white/85 hover:bgç™½/10')}>
        <span className="truncate text-left">{label}</span>
        <span className="text-xs text-white/70">{count}</span>
      </button>
    );

    const PromptCard = ({ prompt, projectName, onOpen, onToggleFav, onCopy }) => (
      <div className="group relative rounded-2xl border borderç™½/15 bgç™½/10 backdrop-blur-xl p-4 shadow-lg hover:shadow-indigo-600/20 transition-transform hover:-translate-y-0.5">
        <div className="absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition">
          <IconButton title="æ”¶è—" onClick={(e)=>{ e.stopPropagation(); onToggleFav(); }}>{prompt.favorite ? 'ğŸ’›' : 'â­'}</IconButton>
          <IconButton title="å¤åˆ¶" onClick={(e)=>{ e.stopPropagation(); onCopy(); }}>ğŸ“‹</IconButton>
        </div>
        <div className="text-base font-semibold truncate mb-2 pr-12">{prompt.title||'(æœªå‘½å)'}</div>
        <div className="text-sm text-white/80 line-clamp-2 min-h-[2.6em]">{prompt.summary || autoSummarize(prompt.content||'')}</div>
        <div className="mt-3 flex items-center justify-between text-xs text-white/60">
          <span>{prompt.createdAt? new Date(prompt.createdAt).toLocaleDateString(): ''}</span>
          <span className="truncate max-w-[50%]">{projectName? <Badge>{projectName}</Badge> : <Badge>æœªå½’æ¡£</Badge>}</span>
        </div>
        <button onClick={onOpen} className="mt-3 w-full rounded-lg bgç™½/10 hover:bgç™½/20 border borderç™½/15 px-3 py-2 text-sm">æŸ¥çœ‹è¯¦æƒ…</button>
      </div>
    );

    const EmptyState = ({ onCreate }) => (
      <GlassCard className="p-10 text-center">
        <div className="text-4xl mb-2">ğŸ§ª</div>
        <div className="text-lg mb-2">è¿˜æ²¡æœ‰ä»»ä½• Prompt</div>
        <div className="text-white/70 mb-4">ä»â€œæ–°å»º Promptâ€å¼€å§‹ï¼Œæˆ–åœ¨ä¸Šæ–¹æœç´¢æ¡†å°è¯•è¾“å…¥â€œå¤–è´¸ å®¢æˆ·å¼€å‘ å¤©çº¿â€ã€‚</div>
        <PrimaryButton onClick={onCreate}>æ–°å»º Prompt</PrimaryButton>
      </GlassCard>
    );

    function PromptEditor({ projects, initial, onSubmit }){
      const [title, setTitle] = useState(initial?.title||'');
      const [content, setContent] = useState(initial?.content||'');
      const [projectId, setProjectId] = useState(initial?.projectId||'');
      const [summary, setSummary] = useState(()=> autoSummarize(initial?.content||''));
      useEffect(()=>{ if(!initial) setSummary(autoSummarize(content)); }, [content]);
      function submit(e){ e.preventDefault(); if(!title.trim() || !content.trim()) return; onSubmit({ title:title.trim(), content:content.trim(), projectId:projectId||null, summary:summary.trim()||autoSummarize(content) }); }
      return (
        <form onSubmit={submit} className="space-y-3">
          <div>
            <label className="block text-sm mb-1">æ ‡é¢˜</label>
            <input value={title} onChange={e=>setTitle(e.target.value)} className="w-full rounded-xl bgç™½/10 border borderç™½/20 px-3 py-2 focus:outline-none" placeholder="è¾“å…¥ç®€çŸ­æ ‡é¢˜" required />
          </div>
          <div>
            <label className="block text-sm mb-1">å½’å±é¡¹ç›®</label>
            <select value={projectId} onChange={e=>setProjectId(e.target.value)} className="w-full rounded-xl bgç™½/10 border borderç™½/20 px-3 py-2 focus:outline-none">
              <option value="">æœªå½’æ¡£</option>
              {projects.map(p=> <option key={p.id} value={p.id}>{p.name}</option>)}
            </select>
          </div>
          <div>
            <label className="block text-sm mb-1">Prompt å†…å®¹</label>
            <textarea value={content} onChange={e=>setContent(e.target.value)} rows="6" className="w-full rounded-xl bgç™½/10 border borderç™½/20 px-3 py-2 focus:outline-none" placeholder="è¾“å…¥å®Œæ•´çš„ Prompt æ–‡æœ¬..." required></textarea>
          </div>
          <div>
            <label className="block text-sm mb-1">è‡ªåŠ¨æ‘˜è¦ï¼ˆå¯æ‰‹åŠ¨ä¿®æ”¹ï¼‰</label>
            <input value={summary} onChange={e=>setSummary(e.target.value)} className="w-full rounded-xl bgç™½/10 border borderç™½/20 px-3 py-2 focus:outline-none" placeholder="ç³»ç»Ÿå°†åŸºäºå†…å®¹è‡ªåŠ¨ç”Ÿæˆ" />
          </div>
          <div className="pt-2 flex items-center justify-end gap-2">
            <button type="button" onClick={()=>onSubmit(null)} className="px-4 py-2 rounded-xl bgç™½/10 border borderç™½/20">å–æ¶ˆ</button>
            <button className="px-4 py-2 rounded-xl bg-indigo-500/90 hover:bg-indigo-500 text-white font-semibold shadow-lg shadow-indigo-500/20">ä¿å­˜</button>
          </div>
        </form>
      );
    }

    const Modal = ({ title, children, onClose }) => (
      <div className="fixed inset-0 z-40 grid place-items-center bg-black/40 p-4" onClick={onClose}>
        <div className="w-full max-w-2xl rounded-2xl border borderç™½/20 bg-[#0e1530]/95 backdrop-blur-xl p-5 shadow-2xl" onClick={(e)=>e.stopPropagation()}>
          <div className="flex items-center justify-between mb-3">
            <div className="text-lg font-semibold">{title}</div>
            <button onClick={onClose} className="text-white/70 hover:text-white">âœ•</button>
          </div>
          {children}
        </div>
      </div>
    );

    // ç™»å½•/æ³¨å†Œè¡¨å•
    function AuthForm({ mode, onToggle }){
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [error, setError] = useState('');
      async function submit(e){
        e.preventDefault(); setError('');
        if(!auth){ setError('æœªå¯ç”¨ Firebaseã€‚è¯·åœ¨ index.html ä¸­å¡«å…¥ firebaseConfigã€‚'); return; }
        try{
          if(mode==='login'){ await auth.signInWithEmailAndPassword(email, password); }
          else { await auth.createUserWithEmailAndPassword(email, password); }
        }catch(err){ setError(err.message || 'æ“ä½œå¤±è´¥'); }
      }
      return (
        <form onSubmit={submit} className="space-y-3">
          <div>
            <label className="block text-sm mb-1">é‚®ç®±</label>
            <input value={email} onChange={e=>setEmail(e.target.value)} type="email" required className="w-full rounded-xl bgç™½/10 border borderç™½/20 px-3 py-2 focus:outline-none" placeholder="you@example.com" />
          </div>
          <div>
            <label className="block text-sm mb-1">å¯†ç </label>
            <input value={password} onChange={e=>setPassword(e.target.value)} type="password" minLength="6" required className="w-full rounded-xl bgç™½/10 border borderç™½/20 px-3 py-2 focus:outline-none" placeholder="è‡³å°‘6ä½" />
          </div>
          {error && <div className="text-sm text-rose-300">{error}</div>}
          <div className="flex items-center justify-between pt-2">
            <button type="button" onClick={onToggle} className="text-indigo-300 hover:text-indigo-200">{mode==='login'?'åˆ‡æ¢åˆ°æ³¨å†Œ':'åˆ‡æ¢åˆ°ç™»å½•'}</button>
            <button className="px-4 py-2 rounded-xl bg-indigo-500/90 hover:bg-indigo-500 text-white font-semibold shadow-lg shadow-indigo-500/20">{mode==='login'?'ç™»å½•':'æ³¨å†Œ'}</button>
          </div>
        </form>
      );
    }

    // æ¸²æŸ“
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>