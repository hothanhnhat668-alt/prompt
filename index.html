<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>奥利给！Prompt云同步库</title>
  <meta name="theme-color" content="#4f46e5" />
  <link rel="manifest" href="manifest.json" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter','ui-sans-serif','system-ui'] },
          colors: { primary:'#4f46e5' }
        }
      }
    };
  </script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone@7/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-storage-compat.js"></script>
  <style>
    :root { color-scheme: dark; }
    body { font-family: Inter, ui-sans-serif, system-ui, -apple-system; }
  </style>
</head>

<body class="min-h-screen text-white bg-gradient-to-b from-[#0b1220] via-[#0e1530] to-[#0b1220]">
  <div id="root"></div>

  <script type="text/babel">
    const { useEffect, useState } = React;

    // ========== Firebase 初始化 ==========
    const firebaseConfig = {
  apiKey: "AIzaSyDirBHX8Vyo3fnvyud2Aq5-dSvjQT4iWps",
  authDomain: "prompt-4a7f5.firebaseapp.com",
  projectId: "prompt-4a7f5",
  storageBucket: "prompt-4a7f5.firebasestorage.app",
  messagingSenderId: "962014780733",
  appId: "1:962014780733:web:205f65cb27de2e042f9354",
  measurementId: "G-9G2DPCKG1V"
};

    let app, auth, storage;
    try {
      app = firebase.initializeApp(firebaseConfig);
      auth = firebase.auth();
      storage = firebase.storage();
    } catch (e) {
      console.error("Firebase 初始化失败，请检查配置：", e);
    }

    // ========== React 主应用 ==========
    function App() {
      const [user, setUser] = useState(null);

      useEffect(() => {
        if (auth) {
          return auth.onAuthStateChanged((u) => {
            setUser(u || null);
          });
        }
      }, []);

      // 邮箱注册
      const handleRegister = async () => {
        const email = prompt("请输入邮箱：");
        const password = prompt("请输入密码（至少6位）：");
        try {
          await auth.createUserWithEmailAndPassword(email, password);
          alert("注册成功！");
        } catch (err) {
          alert("注册失败：" + err.message);
        }
      };

      // 邮箱登录
      const handleEmailLogin = async () => {
        const email = prompt("请输入邮箱：");
        const password = prompt("请输入密码：");
        try {
          await auth.signInWithEmailAndPassword(email, password);
          alert("登录成功！");
        } catch (err) {
          alert("登录失败：" + err.message);
        }
      };

      // 微信扫码登录
      const handleWechatLogin = () => {
        const appid = "替换为你的微信开放平台AppID";
        const redirect_uri = encodeURIComponent(window.location.origin + "/wechat_callback.html");
        const state = Math.random().toString(36).slice(2);
        const url = `https://open.weixin.qq.com/connect/qrconnect?appid=${appid}&redirect_uri=${redirect_uri}&response_type=code&scope=snsapi_login&state=${state}#wechat_redirect`;
        window.location.href = url;
      };

      // 修改昵称
      const changeName = () => {
        const newName = prompt("输入新的昵称：");
        if (newName && auth.currentUser) {
          auth.currentUser.updateProfile({ displayName: newName });
          alert("昵称更新成功！");
        }
      };

      // 上传头像
      const uploadAvatar = (e) => {
        if (e.target.files && e.target.files[0] && auth.currentUser) {
          const file = e.target.files[0];
          const ref = storage.ref().child("avatars/" + auth.currentUser.uid);
          ref.put(file).then(() => {
            ref.getDownloadURL().then((url) => {
              auth.currentUser.updateProfile({ photoURL: url });
              alert("头像更新成功！");
            });
          });
        }
      };

      // 登出
      const logout = () => {
        auth.signOut();
      };

      return (
        <div>
          <header className="flex justify-between items-center px-6 py-3 bg-white/10 backdrop-blur-md">
            <h1 className="text-xl font-semibold">奥利给！Prompt云同步库</h1>
            {user ? (
              <div className="flex items-center gap-3">
                <img src={user.photoURL || "https://via.placeholder.com/50"} className="w-8 h-8 rounded-full" />
                <span>{user.displayName || "未命名用户"}</span>
                <span className="text-sm text-white/70">{user.email}</span>
                <button onClick={changeName} className="px-3 py-1 rounded bg-indigo-500/70 hover:bg-indigo-500">改昵称</button>
                <label className="px-3 py-1 rounded bg-indigo-500/70 hover:bg-indigo-500 cursor-pointer">
                  上传头像
                  <input type="file" accept="image/*" onChange={uploadAvatar} className="hidden" />
                </label>
                <button onClick={logout} className="px-3 py-1 rounded bg-rose-600/70 hover:bg-rose-600">退出</button>
              </div>
            ) : (
              <div className="flex gap-2">
                <button onClick={handleRegister} className="px-3 py-1 rounded bg-indigo-600 hover:bg-indigo-700">注册</button>
                <button onClick={handleEmailLogin} className="px-3 py-1 rounded bg-indigo-500 hover:bg-indigo-600">邮箱登录</button>
                <button onClick={handleWechatLogin} className="px-3 py-1 rounded bg-green-500 hover:bg-green-600">微信扫码登录</button>
              </div>
            )}
          </header>

          <main className="p-6">
            {user ? (
              <div>
                <p className="text-lg">你好，{user.displayName || user.email}！</p>
                <p>你现在已经登录，可以同步云端数据。</p>
              </div>
            ) : (
              <p className="text-lg">请先登录或注册账号。</p>
            )}
          </main>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</body>
</html>
